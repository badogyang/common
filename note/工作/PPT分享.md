https://ticket.quectel.com/browse/STBTWIFI-2449

https://ticket.quectel.com/browse/STBTWIFI-1543



a2dp音频

https://ticket.quectel.com/browse/STBTWIFI-2755



我这边准备分享的是这段时间遇到问题的一些排查思路，和bluez流程的梳理，

首先的话，是耗流问题的排查思路，我总结出来大概有这五个步骤，第一是和原厂数据进行对比，应该我们使用的是公司自己的标准，所以会和原厂的有出入，然后如果有竞品模组的话，可以和竞品模组做一个对比测试，差异不大的话，就可以走评审降级关闭。

对比测试还是有差异的话，就应该确认一下测试环境，先本地复测，然后排查wifi_en有没有下电，如果测试的数据看着很离谱的话，就要怀疑是否是硬件焊接问题，导致有漏电现象。

目前我这边realtek基本上每个项目都会报耗流问题，一是因为realtek功耗确实要比高通模组高，还有就是测试标准都是一套，没有参考原厂的数据，所以现在是测试提jira后，我们这边去进行对比原厂数据。

接下来是两个耗流问题的例子，第一个是ble耗流偏高，这个问题就是走了前三步，第一拿到原厂数据对比，第二竞品数据对比，和竞品比较相差不大后，走评审

下面这个耗流问题就是数据差异很大的情况，开机耗流就达到了一百多毫安，本地复测后，看到结果和测试结果明显不符合，要求测试复测，复测后的结果才正常，这种情况一般就当时模组硬件上出了问题。



第二类问题就是模组拉锯问题的排查思路，首先是排查测试坏境是否有干扰，比如室外场景下，周围有没有多个设备，然后是硬件的性能是否达标（硬件性能一般是天线灵敏度和发射功率），然后确认模组是否有校准，最后和原厂或者竞品数据进行对比，这些都没问题，可以考虑下是否是单片模组不良导致，多测两块模组。第六步是前几天在网上看到的，可以通过发射功率，天线灵敏度这些来推算蓝牙的覆盖范围，通过芯片datasheet上的数据，可以计算出传输距离，然后就知道测试的标准对于这款模组是否合理。



最后这个是前段时间梳理的bluez inquiry流程，bluez分为用户空间和内核空间，用户空间主要有bluetoothd蓝牙守护进程和一些上层应用程序，这些程序有两种方式访问到内核空间，一种之间通过绑定内核IO接口去访问，一种通过dbus调用蓝牙守护进程，然后bluetoothd再去访问内核IO，从架构图也可以看出来，

